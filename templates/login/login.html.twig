{% extends 'base.html.twig' %}

{% block title %}Connexion Piluleo{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.1.0/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/locale/fr.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1.11.10/plugin/updateLocale.js"></script>
{% endblock %}

{% block body %}
<body class="bg-orange-50 dark:bg-gray-900 transition-colors duration-300">
  <header class="bg-orange-400 dark:bg-black sticky top-0 left-0 right-0 w-full z-50 shadow-md">
    <div class="max-w-screen-xl mx-auto flex flex-wrap p-5 flex-col md:flex-row items-center">
      <a href="{{ path('app_home') }}" class="flex title-font font-medium items-center text-white mb-4 md:mb-0">
        <span class="ml-3 text-2xl font-bold">Piluleo</span>
      </a>
      <nav class="md:ml-auto md:mr-auto flex flex-wrap items-center text-base justify-center">
      </nav>
      <div class="flex justify-end ml-4 md:ml-14 boutonDarkMode">
        <label class="swap swap-rotate">
          <input type="checkbox" class="theme-controller" value="dark" />
          <svg class="swap-on fill-current w-10 h-10 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"/>
          </svg>
          <svg class="swap-off fill-current w-10 h-10 text-white" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"/>
          </svg>
        </label>
      </div>
    </div>
  </header>

  <main class="min-h-screen flex flex-col items-center justify-center p-4">
    <h1 class="text-4xl font-bold text-orange-600 dark:text-orange-400 mb-8 text-center">Bienvenue sur notre application</h1>
    
    <div class="w-full max-w-4xl bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-orange-200 dark:border-gray-700 p-8 transition-colors duration-300">
      <h2 class="text-3xl font-bold text-orange-600 dark:text-orange-400 mb-10 text-center">CONNEXION UTILISATEUR</h2>
      
      <form id="loginForm" class="space-y-6" action="{{ path('app_login') }}" method="post">
        <div class="space-y-2">
          <label for="username" class="text-sm font-medium text-gray-700 dark:text-gray-300">Email</label>
          <input type="email" id="username" name="_username" required="required" class="w-full p-3 rounded-md border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 js-pseudo" placeholder="Entrez votre email">
        </div>
        <div class="space-y-2">
          <label for="password" class="text-sm font-medium text-gray-700 dark:text-gray-300">Mot de passe</label>
          <input type="password" id="password" name="_password" required="required" class="w-full p-3 rounded-md border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 js-motdepasse" placeholder="Entrez votre mot de passe">
        </div>
        
        <div class="flex justify-center mt-6">
          <button type="submit" class="bg-orange-500 hover:bg-orange-600 dark:bg-orange-600 dark:hover:bg-orange-700 text-white font-bold py-3 px-6 rounded-md text-xl transition duration-300 ease-in-out transform hover:scale-105 js-bouton">
            Valider
          </button>
        </div>
      </form>
      <p class="text-xl font-bold text-orange-600 dark:text-orange-400 mt-5 text-center js-texte"></p>
      <div class="flex justify-center items-center space-x-2 text-gray-600 dark:text-gray-300 mt-6">
        <p>Vous n'avez pas de compte ?</p>
        <a href="{{ path('app_register') }}" class="text-orange-500 dark:text-orange-400 hover:underline">Inscrivez vous ici</a>
      </div>
    </div>
  </main>

  <script>
    tailwind.config = {
      darkMode: "class",
      theme: {
        extend: {
          backgroundColor: {
            dark: "black",
          },
        },
      },
    };
    
    document.addEventListener("DOMContentLoaded", function () {
      document
        .querySelector(".theme-controller")
        .addEventListener("change", function () {
          if (this.checked) {
            document.documentElement.classList.add("dark");
            document.documentElement.setAttribute("data-theme", "black");
          } else {
            document.documentElement.classList.remove("dark");
            document.documentElement.setAttribute("data-theme", "light");
          }
        });

      const pseudo = document.querySelector('.js-pseudo');
      const motdepasse = document.querySelector('.js-motdepasse');
      const bouton = document.querySelector('.js-bouton');
      const texte = document.querySelector('.js-texte');
      
      const pseudoRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
      const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
      
      function connexion() {
        bouton.addEventListener('click', (e) => {
          e.preventDefault(); 
      
          if (pseudo.value.trim() === '' || motdepasse.value.trim() === '') {
            texte.textContent = "Veuillez remplir tous les champs.";
            texte.classList.add('text-red-600');
          } else if (!pseudoRegex.test(pseudo.value)) {
            texte.textContent = "L'adresse email n'est pas valide.";
            texte.classList.add('text-red-600');
          } else if (!passwordRegex.test(motdepasse.value)) {
            texte.textContent = "Le mot de passe n'est pas valide (au moins 8 caractères, une majuscule, une minuscule, un chiffre et un caractère spécial).";
            texte.classList.add('text-red-600');
          } else {
            texte.textContent = "Connexion validée !";
            texte.classList.remove('text-red-600');
            texte.classList.add('text-green-400');
            document.getElementById('loginForm').submit();
          }
        });
      }
      
      connexion();

      dayjs.locale('fr');
      dayjs.extend(window.dayjs_plugin_updateLocale);
      dayjs.updateLocale('fr', {
        formats: {
          LLL: 'dddd D MMMM YYYY'
        }
      });

      function updateTime() {
        const date = dayjs();
        const currentTimeElement = document.querySelector('.current-time');
        if (currentTimeElement) {
          currentTimeElement.innerHTML = `
            <span class="date">${date.format('dddd D MMMM YYYY, HH:mm:ss').toUpperCase()}</span>
          `;
        }
      }

      setInterval(updateTime, 1000);
      updateTime();
    });
  </script>
</body>
{% endblock %}